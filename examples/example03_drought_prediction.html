<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Drought Prediction with Time Series Modeling &#8212; SPEI 0.8.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <script src="../_static/documentation_options.js?v=486e5634"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Package Comparison" href="example04_package_comparison.html" />
    <link rel="prev" title="Distributions" href="example02_distributions.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="Drought-Prediction-with-Time-Series-Modeling">
<h1>Drought Prediction with Time Series Modeling<a class="headerlink" href="#Drought-Prediction-with-Time-Series-Modeling" title="Link to this heading">¶</a></h1>
<p><em>Martin Vonk - 2022</em></p>
<p>This notebooks shows a quick calculation of the SPI, SPEI and SGI for De Bilt, in the Netherlands. The SGI is calculated using a <a class="reference external" href="https://github.com/pastas/pastas">Pastas</a> time series model since the original time series is too short. The application of time series models for extrapolating groundwater time series is discussed in <a class="reference external" href="https://hess.copernicus.org/articles/26/551/2022/hess-26-551-2022.html">Brakkee et al (2022)</a>.</p>
<section id="Required-packages">
<h2>Required packages<a class="headerlink" href="#Required-packages" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pastas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ps</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">scs</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">spei</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">si</span>  <span class="c1"># si for standardized index</span>

<span class="nb">print</span><span class="p">(</span><span class="n">si</span><span class="o">.</span><span class="n">show_versions</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
python: 3.11.13
spei: 0.8.0
numpy: 2.2.6
scipy: 1.16.1
matplotlib: 3.10.3
pandas: 2.3.1
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
DeprecationWarning: As of Pastas 1.5, no noisemodel is added to the pastas Model class by default anymore. To solve your model using a noisemodel, you have to explicitly add a noisemodel to your model before solving. For more information, and how to adapt your code, please see this issue on GitHub: https://github.com/pastas/pastas/issues/735
</pre></div></div>
</div>
</section>
<section id="Import-time-series">
<h2>Import time series<a class="headerlink" href="#Import-time-series" title="Link to this heading">¶</a></h2>
<p>Time series are imported using the package hydropandas. Enddate is by default yesterday. The head time series is obtained from a Pastas test dataset.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import hydropandas as hpd</span>

<span class="c1"># today = datetime.date.today()</span>
<span class="c1"># yesterday = (today - datetime.timedelta(days=1)).strftime(&quot;%Y-%m-%d&quot;)</span>
<span class="c1"># prec = (</span>
<span class="c1">#     hpd.PrecipitationObs.from_knmi(</span>
<span class="c1">#         meteo_var=&quot;RH&quot;, stn=260, startdate=&quot;1959-07-01&quot;, enddate=yesterday</span>
<span class="c1">#     )</span>
<span class="c1">#     .multiply(1e3)</span>
<span class="c1">#     .squeeze()</span>
<span class="c1"># )</span>
<span class="c1"># prec.index = prec.index.normalize()</span>
<span class="c1"># evap = (</span>
<span class="c1">#     hpd.EvaporationObs.from_knmi(</span>
<span class="c1">#         meteo_var=&quot;EV24&quot;, stn=260, startdate=&quot;1959-07-01&quot;, enddate=yesterday</span>
<span class="c1">#     )</span>
<span class="c1">#     .multiply(1e3)</span>
<span class="c1">#     .squeeze()</span>
<span class="c1"># )</span>
<span class="c1"># evap.index = evap.index.normalize()</span>


<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/DEBILT.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">prec</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Prec [m/d] 260_DEBILT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mf">1e3</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;prec&quot;</span><span class="p">)</span>
<span class="n">evap</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Evap [m/d] 260_DEBILT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mf">1e3</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;evap&quot;</span><span class="p">)</span>
<span class="n">head</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Head [m] B32C0572_DEBILT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;B32C0572&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">today</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">yesterday</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
</section>
<section id="Calculate-SPI-and-SPEI">
<h2>Calculate SPI and SPEI<a class="headerlink" href="#Calculate-SPI-and-SPEI" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Accumulate time series on monthly basis</span>
<span class="n">spi1</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">spi</span><span class="p">(</span><span class="n">prec</span><span class="p">,</span> <span class="n">timescale</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">scs</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span> <span class="n">fit_freq</span><span class="o">=</span><span class="s2">&quot;MS&quot;</span><span class="p">)</span>
<span class="n">spei1</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">spei</span><span class="p">((</span><span class="n">prec</span> <span class="o">-</span> <span class="n">evap</span><span class="p">),</span> <span class="n">timescale</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">scs</span><span class="o">.</span><span class="n">fisk</span><span class="p">,</span> <span class="n">fit_freq</span><span class="o">=</span><span class="s2">&quot;MS&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xlim</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s2">&quot;2018-01-01&quot;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">7.0</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">si</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">si</span><span class="p">(</span><span class="n">spi1</span><span class="p">,</span> <span class="n">ybound</span><span class="o">=</span><span class="mf">3.1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">background</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;roma&quot;</span><span class="p">)</span>
<span class="n">si</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">si</span><span class="p">(</span><span class="n">spei1</span><span class="p">,</span> <span class="n">ybound</span><span class="o">=</span><span class="mf">3.1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">background</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;roma&quot;</span><span class="p">)</span>
<span class="p">[(</span><span class="n">x</span><span class="o">.</span><span class="n">grid</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">),</span> <span class="n">x</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Z-Score&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">]</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Standardized Precipitation Index&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Standardized Precipitation Evaporation Index&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Meteoroligical Drought-Indices De Bilt&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">DeprecationWarning</span>                        Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[4]</span><span class="ansi-green-fg">, line 4</span>
<span class="ansi-green-fg">      1</span> xlim = pd.to_datetime([<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">2018-01-01</span><span class="ansi-yellow-fg">&#34;</span>, df.index[-<span class="ansi-green-fg">1</span>]])
<span class="ansi-green-fg">      3</span> fig, axs = plt.subplots(<span class="ansi-green-fg">2</span>, <span class="ansi-green-fg">1</span>, figsize=(<span class="ansi-green-fg">7.0</span>, <span class="ansi-green-fg">5.5</span>), sharex=<span class="ansi-bold" style="color: rgb(0,135,0)">True</span>)
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">4</span> <span class="ansi-yellow-bg">si</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">plot</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">si</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">spi1</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">ybound</span><span class="ansi-yellow-bg">=</span><span class="ansi-green-fg ansi-yellow-bg">3.1</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">ax</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">axs</span><span class="ansi-yellow-bg">[</span><span class="ansi-green-fg ansi-yellow-bg">0</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">background</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">False</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">cmap</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-fg ansi-yellow-bg">&#34;</span><span class="ansi-yellow-fg ansi-yellow-bg">roma</span><span class="ansi-yellow-fg ansi-yellow-bg">&#34;</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">      5</span> si.plot.si(spei1, ybound=<span class="ansi-green-fg">3.1</span>, ax=axs[<span class="ansi-green-fg">1</span>], background=<span class="ansi-bold" style="color: rgb(0,135,0)">False</span>, cmap=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">roma</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">      6</span> [(x.grid(), x.set_xlim(xlim), x.set_ylabel(<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">Z-Score</span><span class="ansi-yellow-fg">&#34;</span>)) <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> x <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> axs]

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/work/SPEI/SPEI/.tox/docu/lib/python3.11/site-packages/spei/plot.py:67</span>, in <span class="ansi-cyan-fg">si</span><span class="ansi-blue-fg">(si, add_category, figsize, cmap, background, ax, **kwargs)</span>
<span class="ansi-green-fg">     64</span>     colormap = cmap
<span class="ansi-green-fg">     66</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">ybound</span><span class="ansi-yellow-fg">&#34;</span> <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> kwargs:
<span class="ansi-green-fg">---&gt; </span><span class="ansi-green-fg">67</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">DeprecationWarning</span>(
<span class="ansi-green-fg">     68</span>         <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">The </span><span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">ybound</span><span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg"> argument is deprecated and will be ignored. To set y-axis </span><span class="ansi-yellow-fg">&#34;</span>
<span class="ansi-green-fg">     69</span>         <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">limits, use the </span><span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">set_ylim()</span><span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg"> method on the returned Axes instance.</span><span class="ansi-yellow-fg">&#34;</span>
<span class="ansi-green-fg">     70</span>     )
<span class="ansi-green-fg">     72</span> ymin, ymax = -<span class="ansi-green-fg">3.0</span>, <span class="ansi-green-fg">3.0</span>  <span style="color: rgb(95,135,135)"># default y-axis limits, also used for colormap norm</span>
<span class="ansi-green-fg">     74</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> background:

<span class="ansi-red-fg">DeprecationWarning</span>: The &#39;ybound&#39; argument is deprecated and will be ignored. To set y-axis limits, use the &#39;set_ylim()&#39; method on the returned Axes instance.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_example03_drought_prediction_6_1.png" src="../_images/examples_example03_drought_prediction_6_1.png" />
</div>
</div>
</section>
<section id="Create-time-series-model-and-simulate-head">
<h2>Create time series model and simulate head<a class="headerlink" href="#Create-time-series-model-and-simulate-head" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ml</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
<span class="n">rm</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">RechargeModel</span><span class="p">(</span>
    <span class="n">prec</span><span class="p">,</span> <span class="n">evap</span><span class="p">,</span> <span class="n">ps</span><span class="o">.</span><span class="n">Exponential</span><span class="p">(),</span> <span class="n">recharge</span><span class="o">=</span><span class="n">ps</span><span class="o">.</span><span class="n">rch</span><span class="o">.</span><span class="n">FlexModel</span><span class="p">(</span><span class="n">gw_uptake</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">ml</span><span class="o">.</span><span class="n">add_stressmodel</span><span class="p">(</span><span class="n">rm</span><span class="p">)</span>
<span class="n">ml</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">tmin</span><span class="o">=</span><span class="s2">&quot;1970-07-01&quot;</span><span class="p">,</span> <span class="n">report</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">results</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Fit report B32C0572               Fit Statistics
================================================
nfev    67                     EVP         79.71
nobs    1187                   R2           0.80
noise   False                  RMSE         0.11
tmin    1970-07-01 00:00:00    AICc     -5311.02
tmax    2020-12-28 00:00:00    BIC      -5270.51
freq    D                      Obj          6.67
warmup  3650 days 00:00:00     ___
solver  LeastSquares           Interp.        No

Parameters (8 optimized)
================================================
                   optimal     initial   vary
recharge_A        0.474069    0.443936   True
recharge_a      171.662485   10.000000   True
recharge_srmax   70.059716  250.000000   True
recharge_lp       0.250000    0.250000  False
recharge_ks      68.512519  100.000000   True
recharge_gamma    1.263178    2.000000   True
recharge_kv       2.000000    1.000000   True
recharge_simax    2.000000    2.000000  False
recharge_gf       0.246865    1.000000   True
constant_d        0.940004    1.377665   True

Warnings! (1)
================================================
Parameter &#39;recharge_kv&#39; on upper bound: 2.00e+00
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_example03_drought_prediction_8_1.png" src="../_images/examples_example03_drought_prediction_8_1.png" />
</div>
</div>
</section>
<section id="Calculate-SGI-based-on-time-series-model">
<h2>Calculate SGI based on time series model<a class="headerlink" href="#Calculate-SGI-based-on-time-series-model" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gws</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">tmin</span><span class="o">=</span><span class="s2">&quot;1990-07-01&quot;</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="n">yesterday</span><span class="p">)</span>
<span class="n">sgi</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">sgi</span><span class="p">(</span><span class="n">gws</span><span class="p">,</span> <span class="n">fit_freq</span><span class="o">=</span><span class="s2">&quot;MS&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Compare-three-drought-indices-(SPI,-SPEI,-SGI)-in-plot">
<h2>Compare three drought-indices (SPI, SPEI, SGI) in plot<a class="headerlink" href="#Compare-three-drought-indices-(SPI,-SPEI,-SGI)-in-plot" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot_mosaic</span><span class="p">(</span>
    <span class="p">[[</span><span class="s2">&quot;SPI&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;SPEI&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;SGI&quot;</span><span class="p">]],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">si</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">si</span><span class="p">(</span><span class="n">spi1</span><span class="p">,</span> <span class="n">ybound</span><span class="o">=</span><span class="mf">3.5</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="s2">&quot;SPI&quot;</span><span class="p">],</span> <span class="n">add_category</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">si</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">si</span><span class="p">(</span><span class="n">spei1</span><span class="p">,</span> <span class="n">ybound</span><span class="o">=</span><span class="mf">3.5</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="s2">&quot;SPEI&quot;</span><span class="p">],</span> <span class="n">add_category</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">si</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">si</span><span class="p">(</span><span class="n">sgi</span><span class="p">,</span> <span class="n">ybound</span><span class="o">=</span><span class="mf">3.5</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="s2">&quot;SGI&quot;</span><span class="p">],</span> <span class="n">add_category</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">[(</span><span class="n">axs</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(),</span> <span class="n">axs</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Z-Score&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">]</span>
<span class="n">axs</span><span class="p">[</span><span class="s2">&quot;SPI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Standardized Precipitation Index 1&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="s2">&quot;SPEI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Standardized Precipitation Evaporation Index 1&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="s2">&quot;SGI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Standardized Groundwater Index&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Drought-Indices for De Bilt&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1"># fig.savefig(&#39;Drought_Index_Bilt.png&#39;, dpi=600, bbox_inches=&#39;tight&#39;)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">DeprecationWarning</span>                        Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[7]</span><span class="ansi-green-fg">, line 4</span>
<span class="ansi-green-fg">      1</span> fig, axs = plt.subplot_mosaic(
<span class="ansi-green-fg">      2</span>     [[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">SPI</span><span class="ansi-yellow-fg">&#34;</span>], [<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">SPEI</span><span class="ansi-yellow-fg">&#34;</span>], [<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">SGI</span><span class="ansi-yellow-fg">&#34;</span>]], figsize=(<span class="ansi-green-fg">6.5</span>, <span class="ansi-green-fg">8</span>), sharex=<span class="ansi-bold" style="color: rgb(0,135,0)">True</span>
<span class="ansi-green-fg">      3</span> )
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">4</span> <span class="ansi-yellow-bg">si</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">plot</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">si</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">spi1</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">ybound</span><span class="ansi-yellow-bg">=</span><span class="ansi-green-fg ansi-yellow-bg">3.5</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">ax</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">axs</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-fg ansi-yellow-bg">&#34;</span><span class="ansi-yellow-fg ansi-yellow-bg">SPI</span><span class="ansi-yellow-fg ansi-yellow-bg">&#34;</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">add_category</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">False</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">      5</span> si.plot.si(spei1, ybound=<span class="ansi-green-fg">3.5</span>, ax=axs[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">SPEI</span><span class="ansi-yellow-fg">&#34;</span>], add_category=<span class="ansi-bold" style="color: rgb(0,135,0)">False</span>)
<span class="ansi-green-fg">      6</span> si.plot.si(sgi, ybound=<span class="ansi-green-fg">3.5</span>, ax=axs[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">SGI</span><span class="ansi-yellow-fg">&#34;</span>], add_category=<span class="ansi-bold" style="color: rgb(0,135,0)">False</span>)

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/work/SPEI/SPEI/.tox/docu/lib/python3.11/site-packages/spei/plot.py:67</span>, in <span class="ansi-cyan-fg">si</span><span class="ansi-blue-fg">(si, add_category, figsize, cmap, background, ax, **kwargs)</span>
<span class="ansi-green-fg">     64</span>     colormap = cmap
<span class="ansi-green-fg">     66</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">ybound</span><span class="ansi-yellow-fg">&#34;</span> <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> kwargs:
<span class="ansi-green-fg">---&gt; </span><span class="ansi-green-fg">67</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">DeprecationWarning</span>(
<span class="ansi-green-fg">     68</span>         <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">The </span><span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">ybound</span><span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg"> argument is deprecated and will be ignored. To set y-axis </span><span class="ansi-yellow-fg">&#34;</span>
<span class="ansi-green-fg">     69</span>         <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">limits, use the </span><span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">set_ylim()</span><span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg"> method on the returned Axes instance.</span><span class="ansi-yellow-fg">&#34;</span>
<span class="ansi-green-fg">     70</span>     )
<span class="ansi-green-fg">     72</span> ymin, ymax = -<span class="ansi-green-fg">3.0</span>, <span class="ansi-green-fg">3.0</span>  <span style="color: rgb(95,135,135)"># default y-axis limits, also used for colormap norm</span>
<span class="ansi-green-fg">     74</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> background:

<span class="ansi-red-fg">DeprecationWarning</span>: The &#39;ybound&#39; argument is deprecated and will be ignored. To set y-axis limits, use the &#39;set_ylim()&#39; method on the returned Axes instance.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_example03_drought_prediction_12_1.png" src="../_images/examples_example03_drought_prediction_12_1.png" />
</div>
</div>
</section>
<section id="Compare-SPEI-Kernel-Density-Estimate-for-one-month">
<h2>Compare SPEI Kernel Density Estimate for one month<a class="headerlink" href="#Compare-SPEI-Kernel-Density-Estimate-for-one-month" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">monthly_density</span><span class="p">(</span>
    <span class="n">spi1</span><span class="p">,</span> <span class="n">years</span><span class="o">=</span><span class="p">[</span><span class="n">today</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">today</span><span class="o">.</span><span class="n">year</span><span class="p">],</span> <span class="n">months</span><span class="o">=</span><span class="p">[</span><span class="n">today</span><span class="o">.</span><span class="n">month</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Z-Score&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;SPEI&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_example03_drought_prediction_14_0.png" src="../_images/examples_example03_drought_prediction_14_0.png" />
</div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">SPEI</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="example01_indices.html">Standardized Indices</a></li>
<li class="toctree-l2"><a class="reference internal" href="example02_distributions.html">Distributions</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Drought Prediction with Time Series Modeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="example04_package_comparison.html">Package Comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="example05_multiyear_drought.html">Analyzing Multi-Year Droughts</a></li>
<li class="toctree-l2"><a class="reference internal" href="example06_treshold.html">Threshold Drought</a></li>
<li class="toctree-l2"><a class="reference internal" href="example07_knmi.html">KNMI Drought Indices</a></li>
<li class="toctree-l2"><a class="reference internal" href="example08_rai.html">Rainfall Anomaly Index</a></li>
<li class="toctree-l2"><a class="reference internal" href="example09_joss_paper.html">Article for Journal of Open Source Software</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../_api/modules.html">spei</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Examples</a><ul>
      <li>Previous: <a href="example02_distributions.html" title="previous chapter">Distributions</a></li>
      <li>Next: <a href="example04_package_comparison.html" title="next chapter">Package Comparison</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Martin Vonk.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/examples/example03_drought_prediction.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>