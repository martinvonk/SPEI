<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Distributions &#8212; SPEI 0.8.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <script src="../_static/documentation_options.js?v=486e5634"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Drought Prediction with Time Series Modeling" href="example03_drought_prediction.html" />
    <link rel="prev" title="Standardized Indices" href="example01_indices.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="Distributions">
<h1>Distributions<a class="headerlink" href="#Distributions" title="Link to this heading">¶</a></h1>
<p><em>Martin Vonk - 2025</em></p>
<p>This notebook guides you through the process of selecting and fitting probability distributions to time series data, with the aim of calculating a Standardized Drought Index. It is divided into three main parts:</p>
<ol class="arabic simple">
<li><p>SciPy distributions: understanding continuous distribution functions available in <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code></p></li>
<li><p>Comparing data and distributions: fit candidate distributions to data and assess their suitability</p></li>
<li><p>Flexible time scales and distribution fitting: apply fitting procedures to different time scales and understand their impact on the standardized index</p></li>
</ol>
<p>This notebook is meant to improve understanding of the statistical underpinnings behind drought index modeling. While some backend code is shown, you don’t need to use of it to compute an SDI in practice.</p>
<section id="Prerequisites">
<h2>Prerequisites<a class="headerlink" href="#Prerequisites" title="Link to this heading">¶</a></h2>
<section id="Packages">
<h3>Packages<a class="headerlink" href="#Packages" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">calendar</span><span class="w"> </span><span class="kn">import</span> <span class="n">month_name</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Literal</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sps</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">patheffects</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats._survival</span><span class="w"> </span><span class="kn">import</span> <span class="n">EmpiricalDistributionFunction</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">spei</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">si</span>  <span class="c1"># si for standardized index</span>

<span class="nb">print</span><span class="p">(</span><span class="n">si</span><span class="o">.</span><span class="n">show_versions</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
python: 3.11.13
spei: 0.8.0
numpy: 2.2.6
scipy: 1.16.1
matplotlib: 3.10.3
pandas: 2.3.1
</pre></div></div>
</div>
</section>
<section id="Helper-functions">
<h3>Helper functions<a class="headerlink" href="#Helper-functions" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_ecdf</span><span class="p">(</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="n">ecdf</span><span class="p">:</span> <span class="n">EmpiricalDistributionFunction</span><span class="p">,</span>
    <span class="n">s</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">color</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cdf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">ecdf</span><span class="o">.</span><span class="n">probabilities</span><span class="p">,</span>
        <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span>
        <span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">cdf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">idata</span><span class="p">,</span> <span class="n">icdf</span><span class="p">,</span> <span class="n">iecdf</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cdf</span><span class="p">,</span> <span class="n">ecdf</span><span class="o">.</span><span class="n">probabilities</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="p">[</span><span class="n">idata</span><span class="p">,</span> <span class="n">idata</span><span class="p">],</span>
                <span class="p">[</span><span class="n">iecdf</span><span class="p">,</span> <span class="n">icdf</span><span class="p">],</span>
                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">axes_indicator</span><span class="p">(</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span>
    <span class="n">letter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">ha</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">],</span>
    <span class="n">va</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an indicator to the axes.&quot;&quot;&quot;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">letter</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
        <span class="n">xycoords</span><span class="o">=</span><span class="s2">&quot;axes fraction&quot;</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.titlesize&quot;</span><span class="p">],</span>
        <span class="n">horizontalalignment</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span>
        <span class="n">verticalalignment</span><span class="o">=</span><span class="n">va</span><span class="p">,</span>
        <span class="n">path_effects</span><span class="o">=</span><span class="p">[</span>
            <span class="n">patheffects</span><span class="o">.</span><span class="n">Stroke</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">),</span>
            <span class="n">patheffects</span><span class="o">.</span><span class="n">Normal</span><span class="p">(),</span>
        <span class="p">],</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">plot_box</span><span class="p">(</span><span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span> <span class="n">dist</span><span class="p">:</span> <span class="n">si</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">Dist</span><span class="p">,</span> <span class="n">bbox_edgecolor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">textstr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dist</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="se">\n</span><span class="s2">parameters</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">textstr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;c = </span><span class="si">{</span><span class="n">dist</span><span class="o">.</span><span class="n">pars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">textstr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;loc = </span><span class="si">{</span><span class="n">dist</span><span class="o">.</span><span class="n">loc</span><span class="si">:</span><span class="s2">0.1f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">textstr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;scale = </span><span class="si">{</span><span class="n">dist</span><span class="o">.</span><span class="n">scale</span><span class="si">:</span><span class="s2">0.1f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="n">xmax</span> <span class="o">-</span> <span class="nb">bin</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">,</span>
        <span class="mf">0.05</span><span class="p">,</span>
        <span class="n">textstr</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;legend.fontsize&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
        <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">bbox_edgecolor</span>
        <span class="p">),</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Time-series-data">
<h3>Time series data<a class="headerlink" href="#Time-series-data" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">&quot;data/CABAUW.csv&quot;</span><span class="p">,</span>
    <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">surplus</span> <span class="o">=</span> <span class="p">(</span><span class="n">dfi</span><span class="p">[</span><span class="s2">&quot;prec&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">dfi</span><span class="p">[</span><span class="s2">&quot;evap&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;surplus&quot;</span><span class="p">)</span>
<span class="n">surplusm</span> <span class="o">=</span> <span class="n">surplus</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;MS&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="SciPy-distributions">
<h2>SciPy distributions<a class="headerlink" href="#SciPy-distributions" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code> contains a wide array of probability distributions that you can use to model data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scipy_continious_dists</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">_continuous_distns</span><span class="o">.</span><span class="n">__all__</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of continuous distributions: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">scipy_continious_dists</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Examples: </span><span class="si">{</span><span class="n">scipy_continious_dists</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of continuous distributions: 217
Examples: [&#39;ksone&#39;, &#39;kstwo&#39;, &#39;kstwobign&#39;, &#39;norm&#39;, &#39;alpha&#39;, &#39;anglit&#39;, &#39;arcsine&#39;, &#39;beta&#39;, &#39;betaprime&#39;, &#39;bradford&#39;]
</pre></div></div>
</div>
<p>Lets inspect one of the available distributions:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pearson3</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">pearson3</span>
pearson3<span class="o">?</span>
</pre></div>
</div>
</div>
<p>As can be seen the continuous distribtion has a lot of different methods. Most important for this notebook is the fit method. The fit method, by default, uses a <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.rv_continuous.fit.html#scipy.stats.rv_continuous.fit">maximum likelihood estimate</a>. The method returns the shape parameters (loc, scale and others) of the distribution. Lets see what that looks like for one month of data:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surplus_feb</span> <span class="o">=</span> <span class="n">surplusm</span><span class="p">[</span><span class="n">surplusm</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>

<span class="n">fit_parameters</span> <span class="o">=</span> <span class="n">pearson3</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">surplus_feb</span><span class="p">)</span>
<span class="n">fit_cdf</span> <span class="o">=</span> <span class="n">pearson3</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">surplus_feb</span><span class="p">,</span> <span class="o">*</span><span class="n">fit_parameters</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Fit parameters pearson3: loc=</span><span class="si">{:.2f}</span><span class="s2">, scale=</span><span class="si">{:.1f}</span><span class="s2">, skew=</span><span class="si">{:.1f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="o">*</span><span class="n">fit_parameters</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Fit parameters pearson3: loc=0.24, scale=38.5, skew=26.9
</pre></div></div>
</div>
<p>Compare the fitted distribution to the Emperical Cumulative Density Function (similar to the cumulative histogram).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">surplus_feb</span><span class="p">,</span> <span class="n">fit_cdf</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Fitted pearson3 CDF&quot;</span><span class="p">))</span>
<span class="n">e_cdf</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">ecdf</span><span class="p">(</span><span class="n">surplus_feb</span><span class="p">)</span><span class="o">.</span><span class="n">cdf</span>
<span class="n">plot_ecdf</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">surplus_feb</span><span class="p">,</span> <span class="n">ecdf</span><span class="o">=</span><span class="n">e_cdf</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ECDF&quot;</span><span class="p">,</span> <span class="n">cdf</span><span class="o">=</span><span class="n">fit_cdf</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
    <span class="n">surplus_feb</span><span class="p">,</span>
    <span class="n">bins</span><span class="o">=</span><span class="n">e_cdf</span><span class="o">.</span><span class="n">quantiles</span><span class="p">,</span>
    <span class="n">cumulative</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Cumulative histogram&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">10.0</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Precipitation surplus [mm]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative probability&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;Cumulative probability&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_example02_distributions_13_1.png" src="../_images/examples_example02_distributions_13_1.png" />
</div>
</div>
<p>In the SPEI package there is a little wrapper around this dist class that helps with doing some analysis on the distribution. For instance the two-sided Kolmogorov-Smirnov test for goodness of fit. The null hypothesis two-sided test is that the two distributions are identical, the alternative is that they are not identical.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pearson3_pvalue</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">Dist</span><span class="p">(</span><span class="n">surplus_feb</span><span class="p">,</span> <span class="n">pearson3</span><span class="p">)</span><span class="o">.</span><span class="n">ks_test</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pearson3 Kolmogorov-Smirnov test p-value: </span><span class="si">{</span><span class="n">pearson3_pvalue</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Pearson3 Kolmogorov-Smirnov test p-value: 0.747
</pre></div></div>
</div>
<p>Say we choose a confidence level of 95%; that is, we will reject the null hypothesis in favor of the alternative if the p-value is less than 0.05. For e.g. march the p-value is lower than our threshold of 0.05, so we reject the null hypothesis in favor of the default “two-sided” alternative: the data are not distributed according to the fitted pearson3 distribution. But not finding the appropriate distribution is one of the big uncertainties of the standardized index method. However, not a
perfect fit does not mean this distribution is not fit-for-purpose of calculating a drought index. That is up to the modeller to decide.</p>
</section>
<section id="Comparing-data-and-distributions">
<h2>Comparing data and distributions<a class="headerlink" href="#Comparing-data-and-distributions" title="Link to this heading">¶</a></h2>
<p>We’ll reproduce some steps that are normally done internally. Therefor we need to create the SI class and fit the distribution. Well do that for two distributions, the pearson3 and fisk distribution. We’ll make a subplot per month and compare the fitted distribution.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spei_pearson3</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">SI</span><span class="p">(</span><span class="n">surplusm</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">pearson3</span><span class="p">)</span>
<span class="n">spei_pearson3</span><span class="o">.</span><span class="n">fit_distribution</span><span class="p">()</span>

<span class="n">spei_fisk</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">SI</span><span class="p">(</span><span class="n">surplusm</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">sps</span><span class="o">.</span><span class="n">fisk</span><span class="p">)</span>
<span class="n">spei_fisk</span><span class="o">.</span><span class="n">fit_distribution</span><span class="p">()</span>

<span class="n">f</span><span class="p">,</span> <span class="n">axl</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">9.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span>
<span class="p">)</span>
<span class="n">axsr</span> <span class="o">=</span> <span class="n">axl</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="k">for</span> <span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">distf</span><span class="p">),</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">distp</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
    <span class="n">spei_fisk</span><span class="o">.</span><span class="n">_dist_dict</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">spei_pearson3</span><span class="o">.</span><span class="n">_dist_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">month</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">cdf_fisk</span> <span class="o">=</span> <span class="n">distf</span><span class="o">.</span><span class="n">cdf</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
    <span class="n">cdf_pearson3</span> <span class="o">=</span> <span class="n">distp</span><span class="o">.</span><span class="n">cdf</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">distf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cdf_fisk</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
    <span class="n">e_cdf</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">ecdf</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">cdf</span>
    <span class="n">plot_ecdf</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axsr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">ecdf</span><span class="o">=</span><span class="n">e_cdf</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ECDF&quot;</span><span class="p">)</span>
    <span class="n">axsr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="n">cdf_fisk</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Fisk </span><span class="si">{</span><span class="n">distf</span><span class="o">.</span><span class="n">ks_test</span><span class="p">()</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">axsr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="n">cdf_pearson3</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Pearson3 </span><span class="si">{</span><span class="n">distp</span><span class="o">.</span><span class="n">ks_test</span><span class="p">()</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">axsr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">axsr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">month_name</span><span class="p">[</span><span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="p">],</span> <span class="n">title_fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative</span><span class="se">\n</span><span class="s2">probability [-]&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axl</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]]</span>
<span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Surplus [mm/d]&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_example02_distributions_18_0.png" src="../_images/examples_example02_distributions_18_0.png" />
</div>
</div>
<p>Both the Fisk and Pearson3 distirbutions seem to describe the precipitation surplus pretty well visually. The p-value of the KS-test, as shown in the legend, is more than 0.05 for all months and distributions however. This might not be an issue if the series are fit for purpose. For instance, the pearson3 distirbutions seems to fit a better for larger surplus numbers. Only for November the Fisk distribution looks significantly better/smoother than the pearson3 distribution.</p>
</section>
<section id="Flexible-time-scales-and-distribution-fitting">
<h2>Flexible time scales and distribution fitting<a class="headerlink" href="#Flexible-time-scales-and-distribution-fitting" title="Link to this heading">¶</a></h2>
<p>Meteorological and hydrological time series are nowadays typically available at a daily frequency. To accommodate this, the <code class="docutils literal notranslate"><span class="pre">timescale</span></code> argument in the drought index function is designed to be flexible, with units that match the frequency of the input time series. For example, when using daily data, a <code class="docutils literal notranslate"><span class="pre">timescale</span></code> value of <code class="docutils literal notranslate"><span class="pre">30</span></code> corresponds approximately to a one-month drought index, <code class="docutils literal notranslate"><span class="pre">90</span></code> for three months, <code class="docutils literal notranslate"><span class="pre">180</span></code> for six months, and so on.</p>
<p>The frequency at which distributions are fitted (<code class="docutils literal notranslate"><span class="pre">fit_freq</span></code>) determines how many different distributions are fitted. With a daily fit frequency (<code class="docutils literal notranslate"><span class="pre">fit_freq=&quot;D&quot;</span></code>), one distribution is fitted for every day of the year — 365 or 366 in total, depending on leap years. In contrast, a monthly fit (<code class="docutils literal notranslate"><span class="pre">fit_freq=&quot;MS&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;ME&quot;</span></code>) fits a distribution for every month of the year; 12 in total. Although daily fitting is more computationally intensive, it can yield more precise results, as shown in later
sections. Therefore, the number of data points available for each distribution fit depends on both <code class="docutils literal notranslate"><span class="pre">fit_freq</span></code>, the frequency, and the time length of the time series. For instance, with 30 years of monthly data and <code class="docutils literal notranslate"><span class="pre">fit_freq=&quot;MS&quot;</span></code>, each monthly distribution is based on 30 data points. However, fitting a distribution to just 30 values can be challenging — especially for daily data, which is more prone to noise and outliers. By default, the package attempts to infer <code class="docutils literal notranslate"><span class="pre">fit_freq</span></code> based on the
time series frequency. If inference fails, it defaults to a monthly fit. Users can also specify <code class="docutils literal notranslate"><span class="pre">fit_freq</span></code> manually for full control.</p>
<p>To improve fit stability, the <code class="docutils literal notranslate"><span class="pre">fit_window</span></code> argument allows users to include additional data points around each time step. The window size is specified in the same units as the fit frequency. For example for daily data and fit frequency, <code class="docutils literal notranslate"><span class="pre">fit_window=3</span></code> includes data from the day before and after a given date (e.g., March 14th–16th for March 15th) for the fitting of the distribution. A <code class="docutils literal notranslate"><span class="pre">fit_window=31</span></code> for daily data provides a sample size similar to monthly fitting, while retaining daily
resolution. Though experimental, this fit window feature has shown to improve the robustness of daily fits. A fit window with an even number is automaticaly transformed to an odd number.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">timescale</span> <span class="o">=</span> <span class="mi">30</span>

<span class="n">spei_d</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">SI</span><span class="p">(</span>
    <span class="n">series</span><span class="o">=</span><span class="n">surplus</span><span class="p">,</span>
    <span class="n">dist</span><span class="o">=</span><span class="n">sps</span><span class="o">.</span><span class="n">fisk</span><span class="p">,</span>
    <span class="n">timescale</span><span class="o">=</span><span class="n">timescale</span><span class="p">,</span>
    <span class="n">fit_freq</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span>
    <span class="n">fit_window</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">spei_d</span><span class="o">.</span><span class="n">fit_distribution</span><span class="p">()</span>

<span class="n">fit_window_dw</span> <span class="o">=</span> <span class="mi">31</span>
<span class="n">spei_dw</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">SI</span><span class="p">(</span>
    <span class="n">series</span><span class="o">=</span><span class="n">surplus</span><span class="p">,</span>
    <span class="n">dist</span><span class="o">=</span><span class="n">sps</span><span class="o">.</span><span class="n">fisk</span><span class="p">,</span>
    <span class="n">timescale</span><span class="o">=</span><span class="n">timescale</span><span class="p">,</span>
    <span class="n">fit_freq</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span>
    <span class="n">fit_window</span><span class="o">=</span><span class="n">fit_window_dw</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">spei_dw</span><span class="o">.</span><span class="n">fit_distribution</span><span class="p">()</span>

<span class="n">spei_m</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">SI</span><span class="p">(</span>
    <span class="n">series</span><span class="o">=</span><span class="n">surplus</span><span class="p">,</span>
    <span class="n">dist</span><span class="o">=</span><span class="n">sps</span><span class="o">.</span><span class="n">fisk</span><span class="p">,</span>
    <span class="n">timescale</span><span class="o">=</span><span class="n">timescale</span><span class="p">,</span>
    <span class="n">fit_freq</span><span class="o">=</span><span class="s2">&quot;MS&quot;</span><span class="p">,</span>
    <span class="n">fit_window</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">spei_m</span><span class="o">.</span><span class="n">fit_distribution</span><span class="p">()</span>

<span class="n">speid</span> <span class="o">=</span> <span class="n">spei_d</span><span class="o">.</span><span class="n">norm_ppf</span><span class="p">()</span>
<span class="n">speidw</span> <span class="o">=</span> <span class="n">spei_dw</span><span class="o">.</span><span class="n">norm_ppf</span><span class="p">()</span>
<span class="n">speim</span> <span class="o">=</span> <span class="n">spei_m</span><span class="o">.</span><span class="n">norm_ppf</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">month</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">ts_d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;2000-</span><span class="si">{</span><span class="n">month</span><span class="si">}</span><span class="s2">-15&quot;</span><span class="p">)</span>
<span class="n">ts_m</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;2000-</span><span class="si">{</span><span class="n">month</span><span class="si">}</span><span class="s2">-01&quot;</span><span class="p">)</span>
<span class="n">dist_d</span> <span class="o">=</span> <span class="n">spei_d</span><span class="o">.</span><span class="n">_dist_dict</span><span class="p">[</span><span class="n">ts_d</span><span class="p">]</span>
<span class="n">dist_dw</span> <span class="o">=</span> <span class="n">spei_dw</span><span class="o">.</span><span class="n">_dist_dict</span><span class="p">[</span><span class="n">ts_d</span><span class="p">]</span>
<span class="n">dist_m</span> <span class="o">=</span> <span class="n">spei_m</span><span class="o">.</span><span class="n">_dist_dict</span><span class="p">[</span><span class="n">ts_m</span><span class="p">]</span>
<span class="n">data_d</span> <span class="o">=</span> <span class="n">dist_d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
<span class="n">data_dw</span> <span class="o">=</span> <span class="n">dist_dw</span><span class="o">.</span><span class="n">data_window</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
<span class="n">data_m</span> <span class="o">=</span> <span class="n">dist_m</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
<span class="n">cdf_d</span> <span class="o">=</span> <span class="n">dist_d</span><span class="o">.</span><span class="n">cdf</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_d</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
<span class="n">cdf_dw</span> <span class="o">=</span> <span class="n">dist_dw</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">data_dw</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="o">*</span><span class="n">dist_dw</span><span class="o">.</span><span class="n">pars</span><span class="p">,</span> <span class="n">dist_dw</span><span class="o">.</span><span class="n">loc</span><span class="p">,</span> <span class="n">dist_dw</span><span class="o">.</span><span class="n">scale</span><span class="p">)</span>
<span class="n">cdf_m</span> <span class="o">=</span> <span class="n">dist_m</span><span class="o">.</span><span class="n">cdf</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_m</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
<span class="n">ecdf_d</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">ecdf</span><span class="p">(</span><span class="n">data_d</span><span class="p">)</span><span class="o">.</span><span class="n">cdf</span>
<span class="n">ecdf_dw</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">ecdf</span><span class="p">(</span><span class="n">data_dw</span><span class="p">)</span><span class="o">.</span><span class="n">cdf</span>
<span class="n">ecdf_m</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">ecdf</span><span class="p">(</span><span class="n">data_m</span><span class="p">)</span><span class="o">.</span><span class="n">cdf</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axd</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot_mosaic</span><span class="p">(</span>
    <span class="p">[[</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;dw&quot;</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;cdf&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;si&quot;</span><span class="p">,</span> <span class="s2">&quot;si&quot;</span><span class="p">,</span> <span class="s2">&quot;si&quot;</span><span class="p">,</span> <span class="s2">&quot;si&quot;</span><span class="p">]],</span>
    <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;constrained&quot;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">9.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span>
    <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">scatter_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
    <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">edgecolors</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plot_ecdf</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axd</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">],</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_d</span><span class="p">,</span>
    <span class="n">ecdf</span><span class="o">=</span><span class="n">ecdf_d</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Data </span><span class="si">{</span><span class="n">ts_d</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%B </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">th&quot;</span><span class="p">,</span>
    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
    <span class="o">**</span><span class="n">scatter_kwargs</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plot_ecdf</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axd</span><span class="p">[</span><span class="s2">&quot;dw&quot;</span><span class="p">],</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_dw</span><span class="p">,</span>
    <span class="n">ecdf</span><span class="o">=</span><span class="n">ecdf_dw</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Data </span><span class="si">{</span><span class="n">ts_d</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%B </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">th and</span><span class="se">\n</span><span class="si">{</span><span class="n">fit_window_dw</span><span class="si">}</span><span class="s2"> day window&quot;</span><span class="p">,</span>
    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span>
    <span class="o">**</span><span class="n">scatter_kwargs</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plot_ecdf</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axd</span><span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">],</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_m</span><span class="p">,</span>
    <span class="n">ecdf</span><span class="o">=</span><span class="n">ecdf_m</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Data </span><span class="si">{</span><span class="n">ts_m</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%B&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span>
    <span class="o">**</span><span class="n">scatter_kwargs</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">bin</span> <span class="o">=</span> <span class="mf">5.0</span>
<span class="n">xmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">data_d</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">data_dw</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">data_m</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">xmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">data_d</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">data_dw</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">data_m</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xmin</span> <span class="o">//</span> <span class="nb">bin</span> <span class="o">*</span> <span class="nb">bin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">+</span> <span class="nb">bin</span><span class="p">,</span> <span class="nb">bin</span><span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="nb">bin</span><span class="p">))</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="nb">bin</span> <span class="o">*</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">PercentFormatter</span><span class="p">(</span><span class="mf">1.0</span><span class="p">))</span>
<span class="k">for</span> <span class="n">iax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">axd</span><span class="p">[</span><span class="s2">&quot;dw&quot;</span><span class="p">],</span> <span class="n">axd</span><span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">],</span> <span class="n">axd</span><span class="p">[</span><span class="s2">&quot;cdf&quot;</span><span class="p">]]:</span>
    <span class="n">iax</span><span class="o">.</span><span class="n">sharex</span><span class="p">(</span><span class="n">axd</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">])</span>
    <span class="n">iax</span><span class="o">.</span><span class="n">sharey</span><span class="p">(</span><span class="n">axd</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">iax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
        <span class="n">t</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative probability&quot;</span><span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Precipitation</span><span class="se">\n</span><span class="s2">surplus (mm)&quot;</span><span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;dw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Precipitation</span><span class="se">\n</span><span class="s2">surplus (mm)&quot;</span><span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Precipitation</span><span class="se">\n</span><span class="s2">surplus (mm)&quot;</span><span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;cdf&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Precipitation</span><span class="se">\n</span><span class="s2">surplus (mm)&quot;</span><span class="p">)</span>

<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">bins</span><span class="p">,</span>
    <span class="n">dist_d</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="o">*</span><span class="n">dist_d</span><span class="o">.</span><span class="n">pars</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">dist_d</span><span class="o">.</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">dist_d</span><span class="o">.</span><span class="n">scale</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;dw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">bins</span><span class="p">,</span>
    <span class="n">dist_dw</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="o">*</span><span class="n">dist_dw</span><span class="o">.</span><span class="n">pars</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">dist_dw</span><span class="o">.</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">dist_dw</span><span class="o">.</span><span class="n">scale</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">bins</span><span class="p">,</span>
    <span class="n">dist_m</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="o">*</span><span class="n">dist_m</span><span class="o">.</span><span class="n">pars</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">dist_m</span><span class="o">.</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">dist_m</span><span class="o">.</span><span class="n">scale</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;cdf&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="p">[],</span>
    <span class="p">[],</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Fitted </span><span class="si">{</span><span class="n">dist_d</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> distribution&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;cdf&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">bins</span><span class="p">,</span>
    <span class="n">dist_d</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="o">*</span><span class="n">dist_d</span><span class="o">.</span><span class="n">pars</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">dist_d</span><span class="o">.</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">dist_d</span><span class="o">.</span><span class="n">scale</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;cdf&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">bins</span><span class="p">,</span>
    <span class="n">dist_dw</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="o">*</span><span class="n">dist_dw</span><span class="o">.</span><span class="n">pars</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">dist_dw</span><span class="o">.</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">dist_dw</span><span class="o">.</span><span class="n">scale</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;cdf&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">bins</span><span class="p">,</span>
    <span class="n">dist_m</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="o">*</span><span class="n">dist_m</span><span class="o">.</span><span class="n">pars</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">dist_m</span><span class="o">.</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">dist_m</span><span class="o">.</span><span class="n">scale</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;legend.fontsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">8.0</span>

<span class="n">plot_box</span><span class="p">(</span><span class="n">axd</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">],</span> <span class="n">dist_d</span><span class="p">,</span> <span class="n">bbox_edgecolor</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">)</span>
<span class="n">plot_box</span><span class="p">(</span><span class="n">axd</span><span class="p">[</span><span class="s2">&quot;dw&quot;</span><span class="p">],</span> <span class="n">dist_dw</span><span class="p">,</span> <span class="n">bbox_edgecolor</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">)</span>
<span class="n">plot_box</span><span class="p">(</span><span class="n">axd</span><span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">],</span> <span class="n">dist_m</span><span class="p">,</span> <span class="n">bbox_edgecolor</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">)</span>

<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;legend.fontsize&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span>
<span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;dw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;legend.fontsize&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span>
<span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;legend.fontsize&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span>
<span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;cdf&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;legend.fontsize&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span>
<span class="p">)</span>

<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;si&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;SPEI-1&quot;</span><span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;si&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">speid</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
    <span class="n">speid</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Daily fit&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;si&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">speidw</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
    <span class="n">speidw</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Daily fit with window&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;si&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">speim</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
    <span class="n">speim</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Monthly fit&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">year</span> <span class="o">=</span> <span class="mi">2001</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;si&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span>
    <span class="n">ts_m</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">365</span><span class="p">),</span>
    <span class="n">ts_m</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">365</span> <span class="o">+</span> <span class="mi">30</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;si&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span>
    <span class="n">ts_d</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">365</span><span class="p">),</span>
    <span class="n">ts_d</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">365</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;si&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;si&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">MonthLocator</span><span class="p">())</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;si&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s2">&quot;%b%_d</span><span class="se">\n</span><span class="s2">%Y&quot;</span><span class="p">))</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;si&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Z-score&quot;</span><span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;si&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;si&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower left&quot;</span><span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;si&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)</span>
<span class="n">axd</span><span class="p">[</span><span class="s2">&quot;si&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">())</span>

<span class="n">axes_indicator</span><span class="p">(</span><span class="n">axd</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">],</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">)</span>
<span class="n">axes_indicator</span><span class="p">(</span><span class="n">axd</span><span class="p">[</span><span class="s2">&quot;dw&quot;</span><span class="p">],</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">)</span>
<span class="n">axes_indicator</span><span class="p">(</span><span class="n">axd</span><span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">],</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">)</span>
<span class="n">axes_indicator</span><span class="p">(</span><span class="n">axd</span><span class="p">[</span><span class="s2">&quot;si&quot;</span><span class="p">],</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="mf">0.995</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_example02_distributions_22_0.png" src="../_images/examples_example02_distributions_22_0.png" />
</div>
</div>
<p>The figure above illustrates the influence of different distribution fitting strategies — namely, <code class="docutils literal notranslate"><span class="pre">fit_freq</span></code> and <code class="docutils literal notranslate"><span class="pre">fit_window</span></code> on the calculation of the SPEI-1 index over the year 2001. The top row displays the cumulative distribution functions of precipitation surplus data for an excerpt of the time series of April (the 15th). Subplot a shows the case where distributions are fitted daily (<code class="docutils literal notranslate"><span class="pre">fit_freq=&quot;D&quot;</span></code>) without using a fitting window. Here, the fit is based solely on data from April 15th
across 30 years, resulting in a limited sample size and consequently a noisier empirical distribution with a less stable fit. Subplot b also uses a daily fitting frequency but applies a 31-day fitting window (<code class="docutils literal notranslate"><span class="pre">fit_window=31</span></code>) centered on April 15th. This expands the sample to include 31 days of data, significantly increasing the total number of observations and yielding a much smoother and more robust distribution fit. In contrast, Subplot c shows a monthly fitting approach (<code class="docutils literal notranslate"><span class="pre">fit_freq=&quot;MS&quot;</span></code>)
with no fit window, where all April data from each year is used. This produces a stable fit, but because each month is treated separately, sharp transitions can occur at month boundaries, which may introduce artificial discontinuities into the resulting index. This is shown in the red line of subplot e, which is smoother overall but exhibits abrupt changes at the start of each month (e.g., April 1st and November 1st), due to transitions between monthly distributions. These settings allow users
to tailor the standardization process to their data and desired level of temporal precision. Subplot d shows the specific fisk distributions from each parameter set, shown in the text boxes of subplots a,b and c. The changes to the fitted parameter values are obvious, but the fitted distrubtions look similar as seen in subplot d. The result for the z-score is minimal on april 15th but larger for different dates as seen in subplot e.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">SPEI</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="example01_indices.html">Standardized Indices</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Distributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="example03_drought_prediction.html">Drought Prediction with Time Series Modeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="example04_package_comparison.html">Package Comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="example05_multiyear_drought.html">Analyzing Multi-Year Droughts</a></li>
<li class="toctree-l2"><a class="reference internal" href="example06_treshold.html">Threshold Drought</a></li>
<li class="toctree-l2"><a class="reference internal" href="example07_knmi.html">KNMI Drought Indices</a></li>
<li class="toctree-l2"><a class="reference internal" href="example08_rai.html">Rainfall Anomaly Index</a></li>
<li class="toctree-l2"><a class="reference internal" href="example09_joss_paper.html">Article for Journal of Open Source Software</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../_api/modules.html">spei</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Examples</a><ul>
      <li>Previous: <a href="example01_indices.html" title="previous chapter">Standardized Indices</a></li>
      <li>Next: <a href="example03_drought_prediction.html" title="next chapter">Drought Prediction with Time Series Modeling</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Martin Vonk.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/examples/example02_distributions.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>